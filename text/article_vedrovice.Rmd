---
title           : "A resampling approach to spatial arrangement and contents of burials in the Vedrovice cemetery"
author          : "Petr Pajdla"
    # name          : "Petr Pajdla"
    # affiliation   : "Department of Archaeology and Museology,
    #                  Masaryk University, Brno, Czech Republic"
    # email         : "petr.pajdla@gmail.com"
date            : "`r format(Sys.time(), '%d %B, %Y')`"
abstract        :
  "Spatial patterns in cemeteries and grave goods associations are often explored using various informal methods.
  We adopt computationaly intensive methods utilizing resampling approaches both to spatial analysis and
  distributions of objects from the Early Neolithic cemetery in Vedrovice.


  As a result of the investigation we conclude that...
  "

output:
    bookdown::pdf_document2:
    # bookdown::word_document2:
        latex: pdflatex
        fig_caption: true
        number_sections: false
        keep_tex: false
bibliography    : "bib_vedrovice.bib"
csl             : "european-journal-of-archaeology.csl"
---

<!-- note: length - approx. 10 - 12 pages (no bibliography, tables, figures) -->
<!-- i.e. 18 000 - 22 000 characters -->

```{r init, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(here)
```

<!-- ======================================================================= -->

# Introduction

### Questions

* Is there evidence that certain artefacts covary,
    either positively or negatively?
    Do certain artefacts tend to occur together, or are certain combinations
    absent or rare?
* How can the presence and absence data best display which burials
    contain similar artefacts,
    and which artefacts have similar distributions over burials?
* *How can the data be analysed so as to show most clearly the relationships*
    *between the different* **burials** in terms of their **contents**?
* *How can the data be analysed so as to show most clearly the relationship*
    *between the different* **artefacts** in terms of their
    **distributions in graves**?
* How are grave good assemblages related to age and sex?
(... variations in burial rite coinciding with age or sex of the deceased ...)

<!-- ======================================================================= -->

# Material and methods

The material analyzed here comes from Vedrovice – Široká u lesa cemetery.
Originally, the burial ground consisted of at least 108 burials.
Some of the burials were disturbed by later settlement and burial pits in the
area of the cemetery, amateur excavations during the 19th century or later
agricultural activities.
Thus some of the burials are excluded from the analysis due to missing and/or
incomplete data and only a sample of 78 well-preserved burials is analyzed here.
Most of the data was obtained from the original publication [@podborsky2002],
anthropological determination of sex and age were corrected based on
more recent analysis by @dockalova2008. Carbon, nitrogen and strontium isotope
ratios were collected in @whittle2013 and @richards2008.

Each burial was originally characterized by 55 variables but only 35 are
selected for further analysis.
Some of  the original variables are omitted due to their rare occurrence,
for instance spondylus arm ring is present in a single burial only,
thus being useless in establishing relationships between pairs of burials.
Other variables are removed because they are highly dependent on each other.

The variables fall into several categories.
Firstly there are biological and anthropological characteristics derived from
retrieved human skeletal remains including sex, age simplified into age groups,
isotope ratios or body height.

Second large category of variables consists of data on artifacts present in the
burials.
These include variables noting quantities of various types of pottery and
positions of the pottery vessels within the graves,
counts of various raw materials of chipped stone tools,
presence of polished stone axes or adzes, grinding slabs, pebbles,
bone tools and different kinds of personal ornaments.
The personal ornaments include beads made of spondylus shell or marble,
sponylus pendants or oval shaped buckles.
Presence of ochre pigment is also noted.
All the variables in this category are simplified by binarization (presence vs
absence of a trait) in order to minimize effects of only several numerous
cases on the overall pattern, for instance 20 beads in a grave <!-- 70 -->
would have much larger effect on the analysis then 1 pottery vessel in the same grave.

Last category describes physical characteristics of the grave pit and the
position of the body.
I. e. size of the pit, its orientation, position of the body on one of
the sides and direction of the head.

Data is analyzed in an R environment for statistical computing and graphics
[@rcore]  using functions of readr [@wickham2017a], dplyr [@wickham2016] and
reshape2 [@wickham2007] packages to manipulate the data.
Function daisy [@kaufman1990] from package cluster [@maechler2016] is used to
count distances between observations used in further analyses.
<!-- ADD METHODS AND PACKAGES USED IN R, or into SI?-->

## Spatial patterning

Spatial patterning in prehistoric burial grounds is often examined to find
any internal structure, arrangement or possible grouping.
We approach the task as a point pattern analysis problem given that
a burial (event) is simplified as its centroid location in a two dimensional space.
A polygon of the excavation extent is used as a study area (a window).
Using a window closely approximating locations of the burials was considered,
e. g. buffer zone or convex/concave hull but simplified excavation polygon is
deemed the most useful because it preserves the *natural* borders and empty areas
of the original cemetery.

Overall structure of the burial ground is examined using both density based approach
and distance based methods <!--[@osullivan2010, 121-154]-->.
It is argued that density based approaches, for instance quadrat tests,
characterize the point pattern in terms of its *first-order properties* [@osullivan2010, 126].
The assumption underlying the *first-order effects* is that any point location is
independent on other point locations and different parameters influence the location.
On the other hand the methods based on distances between neighbours and triples of neighbors
characterize the point pattern based on *second- and third-order effects*
[@nakoinz2016, 130-135; @osullivan2010, 107].
<!-- [@nakoinz2016, 135-144; @osullivan2010, 130-139] -->

In spatial analysis of settlement patterns individual locations of
settlements (points) can depend on a number of parameters, for instance
elevation, soil type etc.
In case of a grave placement in a burial ground we presume that the choice of
a location is influenced predominantly by other (previous) grave locations and
is largely independent on other parameters.
In other words *first-order properties* are of little to no importance in
our point of view.
The *second-order properties*, and possibly *third-order properties* [@nakoinz2016, 130, 144]
are thus considered major factors in locating of the graves.
<!-- It is possible that the position of burials was dependent on parameters that were not
captured by the excavation, for example location of trees but that is impossible to test.-->

To characterize the pattern based on density, the quadrat test is employed.
It divides the area of interest into several cells of fixed sizes
(quadrats) and compares the count of events per quadrat with the count
expected under the null hypothesis that the underlying point process
is completely spatially random (approximated by a Poisson distribution).
Functions $G$, $F$, Ripley's $K$ [@ripley1976; @sayer2013] and $T$ [@schladitz2000] are
based on the nearest neighbour distances [@nakoinz2016, 135-144].
The $G$ function is a metric of how close events are and summarises
cummulative frequency distribution of the nearest neighbour distances.
Because of its dependence on the intensity of events in the study area, it is
subject to changes in the size of the study area.
The $F$ function, also empty-space function, is based on simulating a point pattern
and calculating of distances between random locations and the observed locations.
It is a measure of how far are observed events from any arbitrary location [@osullivan2010, 132-135].
Ripley's $K$ function is in comparison with the $G$ function resilient to
changes in the window size and works with all the proximal events up to a
certain threshold, not only the nearest neighbours [@nakoinz2016, 138].
It is widely used in archaeology [@negre2018].
Last but not least, the $T$ function is a third-order parallel to the $K$ function [@schladitz2000].

If $s_i$ is an event location, then 
$G$ function is given by the formula
\@ref(eq:gfun)

\begin{equation}
  \label{eq:gfun}
  G(d) = \frac{\#[d_{min}(s_i)<d]}{n}
\end{equation}

$F$ function by 
$$F(d) = \frac{\#[d_{min}(p_i, S)<d]}{m}$$
where ${p_1 \cdots p_i \cdots p_m}$ is a set of $m$ randomly selected locations.
Ripley's $K$ function
$$K(d) = \frac{\alpha}{n}\frac{1}{n}\sum_{i=1}^n \#[S \in C(s_i, d)]$$
$T$ function
$$ $$


Given statistics for independent random process are estimated using Monte Carlo
simulation with 99 iterations.
The most extreme results of simulations are discarded as outliers and the
second most extreme results are used to construct envelopes encompassing the
expected range for a given function [@baddeley2016 384-403].

To explore whether neighboring individuals are more often of the same sex we
construct a Gabriel graph [@gabriel1969] with burial locations as nodes (Fig. \@ref(fig:gabriel)).
For each node, mean sex of the neighbors is determined and recorded.
To check how common the observed value is, we perform a permutation test
where sex of burials is randomly assigned while preserving the overall
proportion of given categories and the neighborhood struture determined by the
Gabriel graph.
The observed values of neighbors sex categories are compared against distributions
derived from the simulated data.

```{r gabriel, fig.cap = "Gabriel graph"}
knitr::include_graphics(here("plots", "plan_vedrovice_gabriel.pdf"))
```

## Randomness of artefact combinations

<!--
This study takes advantage of computer-intensive resam-
pling techniques that are based on simulations of the behavior
of statistical models through the generation of random samples
(Baxter, 2003; Efron and Tibshirani, 1993; Manly, 1991). The
strength of these techniques lies in the potential to effectively
distinguish between random and non-random patterns and to
test differences between samples without making assumptions
about the population from which these samples were drawn
(Drennan and Peterson, 2004). These techniques proved to
be very effective for the analysis of patterns in cemeteries
(Manly, 1996).
@sosna2008 -->

@sosna2013

To determine non-randomness of various artefact combinations we conduct a
permutation test on the presence/absence data matrix.
The method based on generalized Monte Carlo tests was first
introduced to archaeology by @manly1996 and adapted by @sosna2008.
Our approach is based on both of these works.
Original (observed) co-occurence matrix is permutated $n$ times with constant
row and column totals, i. e. both the count of artifacts in individual graves
and sum of the given type of artifacts across the burials are fixed.

To examine which associations of variables are infrequent or even not present
and which tend to appear together co-occurences of observed and simulated data
are summarized using two statistics suggested by @manly1996.
The $S$ statistic is a measure of overall deviation between expected and observed
number of artefact occurences while
the $v$ statistic is a measure of difference between co-occurences of
individual artefact with other artifacts
[@manly1996, 475, for details see SI].

With $n = 999$ permutations of the original data matrix the results obtained
are robust

## Exceptionality index

Exceptionality index ($EI$) is used in order to induce relative exceptionality
of individual burials based on their attributes.
This approach is independent on a prior selection of attributes of importance
or *prestige*.
It was defined by @demjan2015[367] based on a Root Mean Square (*quadratic mean*) of
PCA factor scores:
$$ EI_{attr_g}=\sqrt{\frac{1}{n}\sum_{i=1}^{n}s_i^2} $$
where $s_i$ are factor scores of individual graves. The mean value is
normalized to range $[0-1]$:

$$ EI_{attr_g}=\frac{EI_{attr_g}}{max~EI_{attr_g}} $$

## Distance between burials

The input variables are of mixed data types, thus Gower's similarity
coefficient [@gower1971] is used in order to obtain a square distance matrix.
Gower's coefficient treats differently symmetric and asymmetric dichotomous
data, nominal and ordinal data and interval and ratio scaled data.
Advantage of this approach is that different kinds of variables can be analyzed
together and it is not necessary to transform the variables into same data
types, as it would be if other distance measure was used.
In our case, most of the variables concerning artifacts deposited within the
burials are asymmetric binary data, i. e. the presence of a trait means
similarity but absence does not imply similarity.
Continuous quantitative variables are treated as interval scaled.
Age categories are treated as ordinal variable and the rest of categorical
variables is treated as nominal data.

<!-- ======================================================================= -->

# Results

## Spatial patterning

The quadrat test suggests both random and clustered processes with p values
under the 0.05 alpha value but the $\chi^2$ approximation is inaccurate due to small
expected counts (for the details see supplementary information).
Fig. \@ref(fig:spat-funs) shows that the curves of $G$ and $F$ functions do not
deviate too much from the curves expected under independent random process nor
do they traverse the boundaries of the envelopes.
This tells us that both the cummulative nearest-neighbor distance (*G*) and
distance to any random location in the space of the window (*F*) are well
approximated by random processes and do not show evidence for spatial clustering.
On the other hand, both *K* and *T* curves have a steep rise and exceed the
envelope boundaries.
These functions thus show evidence for clustering process in the observed point
pattern.


```{r label-spat-funs}
label_spat_funs <- paste("Functions *G*, *F*, *K* and *T*.",
"*Dashed line* -- theoretical curve under complete spatial randomness, *solid line* -- empirical curve, *gray area* -- envelope.")
```
```{r spat-funs, fig.cap = label_spat_funs}
knitr::include_graphics(here("plots", "pointprocess_fun.pdf"))
```

```{r label-neigh_sex}
label_neigh_sex <- paste("Mean neighbors in a given sex category",
"*Gray area* -- density estimation for the simulated data, *vertical line* -- observed value.",
"*F* -- female, *M* -- male, *n. a.* -- non adult.")
```
```{r neigh-sex, fig.cap = label_neigh_sex}
knitr::include_graphics(here("plots", "prob_neighbour_sex.pdf"))
```


## Randomness of artefact combinations

By counting co-occurences of analyzed variables on simulated data matrices and comparing
the distributions of the two studied statistics with the values calculated for
the original dataset we can establish whether the overall pattern of artefacts
distribution in the graves is non-random and further identify artefacts that deviate
from the random pattern.
The value of $S$ statistic is deemed significantly large at the 0.05 alpha level with
$S \approx 14$ and $p \approx xy$ (Fig. \@ref(fig:f-sstat)).
This suggests that there is enough evidence that the overall distribution of
artefacts in the graves is not random.


<!-- ```{r t-vstat} -->
<!-- vstat <- read_csv(here("data/temp", "v_statistics.csv")) %>% -->
<!--     select(full, v, p) %>% -->
<!--     mutate(v = round(v, 2), p = round(p, 2)) %>% -->
<!--     rename("variable" = full, "v statistic" = v, "p value" = p) -->

<!-- knitr::kable( -->
<!--   vstat, -->
<!--   caption = 'Fuuuuu' -->
<!-- ) -->
<!-- ``` -->

```{r f-sstat, fig.cap = "Distribution of simulated and observed S statistic"}
knitr::include_graphics(here("plots", "s_statistic.pdf"))
```

```{r f-vstat, fig.cap = "Simulated and observed v statistics for different variables"}
knitr::include_graphics(here("plots", "v_values.pdf"))
```

```{r f-cooc, fig.cap = "Networks of variables frequently present together and exluding each other"}
knitr::include_graphics(here("plots", "cooc_networks.pdf"))
```


<!-- ======================================================================= -->

# Discussion

<!-- ======================================================================= -->

# References
