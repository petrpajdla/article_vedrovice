---
title           : "Spatial Analysis and Grave Goods Distribution at the Cemetery of Vedrovice"
# "A resampling approach to spatial arrangement and contents of burials in the Vedrovice cemetery"

author          : "Petr Pajdla"
    # name          : "Petr Pajdla"
    # affiliation   : "Department of Archaeology and Museology,
    #                  Masaryk University, Brno, Czech Republic"
    # email         : "petr.pajdla@gmail.com"
date            : "`r format(Sys.time(), '%d %B, %Y')`"
abstract        :
  "Spatial patterns in cemeteries and grave goods associations are often explored using various informal methods.
  We adopt computationaly intensive methods utilizing resampling approaches both to spatial analysis and
  distributions of objects from the Early Neolithic cemetery in Vedrovice.


  As a result of the investigation we conclude that...  "

output:
    bookdown::pdf_document2:
    # bookdown::word_document2:
        latex: pdflatex
        fig_caption: true
        number_sections: false
        keep_tex: false
bibliography    : "bib_vedrovice.bib"
csl             : "european-journal-of-archaeology.csl"
---

<!-- note: length - approx. 10 - 12 pages (no bibliography, tables, figures) -->
<!-- i.e. 18 000 - 22 000 characters -->

```{r init, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(here)
```

<!-- ======================================================================= -->

# Introduction

The Cemetery of Vedrovice is one of the earliest and most intensively studied
*Linearbandkeramik* (LBK) cemeteries.
Recent contributions use the evidence from the cemetery in a broader discussion
of post-marital residence patterns [@hrncir2020] and
sexual inequalities and gender in the Neolithic [@masclanslatorre2020; @bickle2020].
<!-- Here we focus on detailed analysis of the distribution of the grave goods and
spatial analysis of the Vedrovice cemetery in respect to gender relations and
social structure. -->
Here we explore the relations between burials and bodies in terms of biologicall
sex, age, localness, exceptionality of grave goods and position within the cemetery.

<!-- view of gender in the Neolithic, archaeological context -->
@robb2017 [128] noted lack of gender archaeology debate for the
European Neolithic in comparison with other periods.
This is due to the notion of gender in the Neolihic that is presented as being
of a very different nature than gender in the later prehistory.
Authors show that gender in the Neolithic is not clearly expressed and
biological differences between sexes are not transformed into binary cultural
categories (ibid. 140-142).
Considering the Neolithic burial evidence across Europe, authors find that it
'shows very little gender distinction; when it does, it is rarely a clear-cut
binary categorization but a matter of degree and overlap, sometimes polythetically
combined with factors such as age and localness' (ibid. 138).
In response, @bickle2020 [14] argues that 'biological sex may not have defined gender
during the LBK' although the 'sexed bodies did matter'.

<!-- gender relations in LBK -->
Although gender relations in the LBK might not be

<!-- resampling and computer-intensive techniques-->
The approach taken is a quantitative one embracing resampling techniques and
computer-intensive methods in general.
The resampling techniques were introduced to mortuary studies by
@manly1996 but the application is still limited [@sosna2008, 343].
As noted by Sosna (ibid.), the most important benefit of resampling is in its
ability to distinguish random and non-random patterns.


### Questions

* Is there evidence that certain artefacts covary,
    either positively or negatively?
    Do certain artefacts tend to occur together, or are certain combinations
    absent or rare?
* How can the presence and absence data best display which burials
    contain similar artefacts,
    and which artefacts have similar distributions over burials?
* *How can the data be analysed so as to show most clearly the relationships*
    *between the different* **burials** in terms of their **contents**?
* *How can the data be analysed so as to show most clearly the relationship*
    *between the different* **artefacts** in terms of their
    **distributions in graves**?
* How are grave good assemblages related to age and sex?
(... variations in burial rite coinciding with age or sex of the deceased ...)

<!-- ======================================================================= -->

# Material and methods

<!-- site -->
The material analyzed here comes from Vedrovice – Široká u lesa cemetery.

<!-- sample (burials, artefacts) -->
Originally, the burial ground consisted of at least 108 burials.
Some of the burials were disturbed by later settlement and burial pits in the
area of the cemetery, amateur excavations during the 19th century or later
agricultural activities.
These burials are excluded from the analysis due to missing and/or
incomplete data and only a sample of 78 well-preserved burials is analyzed here.
Most of the data was obtained from the original publication [@podborsky2002],
anthropological determination of sex and age were corrected based on
more recent analysis by @dockalova2008. Carbon, nitrogen and strontium isotope
ratios were collected in @whittle2013 and @richards2008.
Further details on use and function of the artefacts were gathered from
@masclanslatorre2020.

Each burial was originally characterized by 55 variables but only subset of
35 variables was selected for further analysis.
Some of  the original variables are omitted due to their rare occurrence,
for instance spondylus arm ring is present in a single burial only,
thus being useless in establishing relationships between pairs of burials.
Other variables are removed because they are highly dependent on each other.

The variables fall into several categories.
Firstly there are biological and anthropological characteristics derived from
retrieved human skeletal remains including sex, age simplified into age groups,
isotope ratios and body height.

Second large category of variables consists of data on artifacts presence and
absence in the burials.
These include variables noting quantities of various types of pottery and
positions of the pottery vessels within the graves,
counts of various raw materials of chipped stone tools,
presence of polished stone axes or adzes, grinding slabs, pebbles,
bone tools and different kinds of personal ornaments.
The personal ornaments include beads made of spondylus shell or marble,
sponylus pendants or oval shaped buckles.
Presence of ochre pigment is also noted.
All the variables in this category are simplified by binarization (presence vs
absence of a trait) in order to minimize effects of only several numerous
cases on the overall pattern, for instance 20 beads in a grave <!-- 70 -->
would have much larger effect on the analysis then 1 pottery vessel in the same grave.

Last category describes physical characteristics of the grave pit and the
position of the body.
I. e. size of the pit, its orientation, position of the body on one of
the sides and direction of the head.

<!-- methods -->

<!-- spatial analysis -->
## Spatial patterning

Spatial patterning in prehistoric burial grounds is often examined to find
any internal structure, arrangement or possible grouping.
We approach the task as a point pattern analysis problem given that
a burial (event) is simplified as its centroid location in a two dimensional space.
A polygon of idealized excavation extent is used as a study area (a window).
Using a window closely approximating locations of the burials was considered,
e. g. buffer zone or convex/concave hull but simplified excavation polygon is
deemed the most useful because it preserves the borders and empty areas
of the original cemetery.

Overall structure of the burial ground is examined using both density based approach
and distance based methods. <!--[@osullivan2010, 121-154]-->
Density based approaches, for instance quadrat tests,
characterize the point pattern in terms of its *first-order properties* [@osullivan2010, 126].
The assumption underlying the *first-order effects* is that any point location is
independent on other point locations and different parameters influence the location.
On the other hand the methods based on distances between neighbours and triples of neighbors
characterize the point pattern based on *second- and third-order effects*
[@nakoinz2016, 130-135; @osullivan2010, 107].
<!-- [@nakoinz2016, 135-144; @osullivan2010, 130-139] -->

In spatial analysis of settlement patterns individual locations of
settlements (points) can depend on a number of parameters, for instance
elevation, soil type etc.
In case of a grave placement in a burial ground we presume that the choice of
a location is influenced predominantly by other (previous) grave locations and
is largely independent on other parameters.
In other words *first-order properties* are of little to no importance in
our point of view.
The *second-order properties*, and possibly *third-order properties*
are thus considered major factors in locating of the graves.
<!-- It is possible that the position of burials was dependent on parameters that were not
captured by the excavation, for example location of trees but that is impossible to test.-->

To characterize the pattern based on density, the quadrat test is employed.
It divides the area of interest into several cells of fixed sizes
(quadrats) and compares the count of events per quadrat with the count
expected under the null hypothesis that the underlying point process
is completely spatially random (approximated by a Poisson distribution).
Functions $G$, $F$, Ripley's $K$ [@ripley1976; @sayer2013] and $T$ [@schladitz2000] are
based on the nearest neighbour distances [@nakoinz2016, 135-144].
The $G$ function is a metric of how close events are and summarises
cummulative frequency distribution of the nearest neighbour distances.
Because of its dependence on the intensity of events in the study area, it is
subject to changes in the size of the study area.
The $F$ function, an empty-space function, is based on simulating a point pattern
and calculating of distances between random locations and the observed locations.
It is a measure of how far are observed events from any arbitrary location [@osullivan2010, 132-135].
Ripley's $K$ function is in comparison with the $G$ function resilient to
changes in the window size and works with all the proximal events up to a
certain threshold, not only the nearest neighbours [@nakoinz2016, 138].
It is widely used in archaeology [@negre2018].
Last but not least, the $T$ function is a third-order parallel to the $K$ function [@schladitz2000].
For formulas of the individual functions see the supplement.

Given statistics for independent random process are estimated using Monte Carlo
simulation with 999 iterations.
Ten most extreme realizations of the simulation are discarded as outliers to
get a significance level $\alpha = 0.01$ [@baddeley2016 384-403].

To explore whether neighboring individuals are more often of the same sex we use
three methods to establish neighborhood relations.
The first two methods are based on constructing neighborhood graphs.
We use Delaunay triangulation and its subgraph, a Gabriel graph [@gabriel1969]
with burial locations as nodes (Fig. \@ref(fig:plan-graphs)).
The Delaunay triangulation can be considered a maximum number of neighbors case
scenario while the Gabriel graph the exact opposite.
For each node, mean number of neighbors of a given sex is determined and recorded.
To check how common the observed value is, a permutation test
where sex of burials is randomly assigned while preserving the overall
proportion of given categories and the neighborhood structure determined by the
graphs is performed.
The observed values of neighbors sex categories are compared against distributions
derived from the simulated data.

The third approach of establishing neigborhood is by constructing buffer zones
around each of the burials with 6 meters radius.
The size of a radius is based on the results of nearest neighbors analysis, where
at the given radius there is strong evidence of a clustering process (Fig. \@ref(fig:spat-funs)).
The randomness is again tested using a permutation test similar to the one
described for the neighborhood derived from the graphs.

<!-- software packages -->
Data is analyzed in an R environment for statistical computing and graphics
[@rcore] using functions of many different packages, for the complete list
see the supplementary information.

<!-- readr [@wickham2017a], dplyr [@wickham2016] and
reshape2 [@wickham2007] packages to manipulate the data.
Function daisy [@kaufman1990] from package cluster [@maechler2016] is used to
count distances between observations used in further analyses. -->




## Randomness of artefact combinations

<!--
This study takes advantage of computer-intensive resam-
pling techniques that are based on simulations of the behavior
of statistical models through the generation of random samples
(Baxter, 2003; Efron and Tibshirani, 1993; Manly, 1991). The
strength of these techniques lies in the potential to effectively
distinguish between random and non-random patterns and to
test differences between samples without making assumptions
about the population from which these samples were drawn
(Drennan and Peterson, 2004). These techniques proved to
be very effective for the analysis of patterns in cemeteries
(Manly, 1996).
@sosna2008 -->

@sosna2013

To determine non-randomness of various artefact combinations we conduct a
permutation test on the presence/absence data matrix.
The method based on generalized Monte Carlo tests was first
introduced to archaeology by @manly1996 and adapted by @sosna2008.
Our approach is based on both of these works.
Original (observed) co-occurence matrix is permutated $n$ times with constant
row and column totals, i. e. both the count of artifacts in individual graves
and sum of the given type of artifacts across the burials are fixed.

To examine which associations of variables are infrequent or even not present
and which tend to appear together co-occurences of observed and simulated data
are summarized using two statistics suggested by @manly1996.
The $S$ statistic is a measure of overall deviation between expected and observed
number of artefact occurences while
the $v$ statistic is a measure of difference between co-occurences of
individual artefact with other artifacts
[@manly1996, 475, for details see SI].

With $n = 999$ permutations of the original data matrix the results obtained
are robust

## Exceptionality index

Exceptionality index ($EI$) is used in order to induce relative exceptionality
of individual burials based on their attributes.
This approach is independent on a prior selection of attributes of importance
or *prestige*.
It was defined by @demjan2015[367] based on a Root Mean Square (*quadratic mean*) of
PCA factor scores:
$$ EI_{attr_g}=\sqrt{\frac{1}{n}\sum_{i=1}^{n}s_i^2} $$
where $s_i$ are factor scores of individual graves. The mean value is
normalized to range $[0-1]$:

$$ EI_{attr_g}=\frac{EI_{attr_g}}{max~EI_{attr_g}} $$

## Distance between burials

The input variables are of mixed data types, thus Gower's similarity
coefficient [@gower1971] is used in order to obtain a square distance matrix.
Gower's coefficient treats differently symmetric and asymmetric dichotomous
data, nominal and ordinal data and interval and ratio scaled data.
Advantage of this approach is that different kinds of variables can be analyzed
together and it is not necessary to transform the variables into same data
types, as it would be if other distance measure was used.
In our case, most of the variables concerning artifacts deposited within the
burials are asymmetric binary data, i. e. the presence of a trait means
similarity but absence does not imply similarity.
Continuous quantitative variables are treated as interval scaled.
Age categories are treated as ordinal variable and the rest of categorical
variables is treated as nominal data.

<!-- ======================================================================= -->

<!-- results -->

# Results

## Spatial patterning

The quadrat test shows evidence for both random and clustered processes taking place with p values
under the 0.05 alpha value but the $\chi^2$ approximation is inaccurate due to small
expected counts (for the details see supplementary information).
Inconclusive result of the quadrat test is not suprising because as was noted
earlier, we do not expect *first-order* properties to play major roles in
placing of the individual burials.
Results of functions based on nearest neighbors are reported in Fig. \@ref(fig:spat-funs).
*G* function does deviate from the curve expected under independent random process
but does not traverse the boundaries of the envelope.
Thus the cummulative nearest-neighbor distance (*G*) is well approximated by
random process and does not show evidence for spatial clustering nor repelent functions
taking place.
The empty-space function *F* deviates slightly from the area defined by
the envelope at around 6 meters.
This means that the number of nearest neighbours to any empty-space point
at this and larger distances is lower than it would be expected under complete spatial randomness.
On the contrary to only slight deviations in case of *G* and *F*
the *K* and *T* functions show clear deviations from the expected curve and exceed
the boundaries of given envelopes at the distance of around 5 to 6 meters in
case of *K* and slightly more in case of *T* function.
This means that numbers of nearest neighbors at this and larger distances is
significantly higher than we would exect under complete spatial randomness.
The overall point pattern thus shows clear signs of clustering process taking place.

This means that the locations of new burials were not chosen at random
but were affected by the positions of previous burials.
The pattern begins to cluster at the distance of around 5 to 6 meters, meaning
that beginning at this distance, the probability of finding a neighboring burial is
much higher than it would be if the burials were placed randomly.
The community burying their dead at the cemetery of Vedrovice -- Široká u lesa
did so in an organized manner taking into account previous burials at the same place,
meaning their positions were known, probably marked on the surface somehow.
This would imply either non-perishable marks on the surface of the cemetery or their
maintenance from time to time.

Spatial pattern was also explored for differently sexed bodies.


## Neighborhood structure

Three methods of neighborhood relationship construction were examined.
One is distance based where all the neighbors that fall into a given buffer are considered,
the other two are based on neighborhood graphs, the Delaunay triangulation as a
maximum number of neighbors scenario and a Gabriel graph as a minimal scenario.

For relationships (see Fig. \@ref(fig:nb-sex) and Tab. \@ref(tab:nb-tab-sex))
of male-sexed bodies, none of the methods showed any significant
differences between expected and observed number of neighbors of a given sex.
The relationship with female-sexed bodies is rather extreme for all of the methods employed,
but never significant ($p > 0.07$).
In case of bodies unsexed due to early age (non-adults), the neigborhood based
on buffer zones show a signficant realtionship with other non-adults ($p \approx 0.04$).
Finally burials with female-sexed bodies show a significantly higher number of
burials with male-sexed bodies in both the methods based on neighborhood networks
(Delaunay triangulation $p \approx 0.02$ and Gabriel graph $p \approx 0.03$).
Two further relationships showed non-random deviations.
In case of Delaunay trinagulation for burials with bodies with indeterminate sex with
non-adults ($p \approx 0.02$) and in case of Gabriel graph between non-adults and
indeterminate category $p \approx 0.02$.

## Randomness of artefact combinations

By counting co-occurences of analyzed variables on simulated data matrices and comparing
the distributions of the two studied statistics with the values calculated for
the original dataset we can establish whether the overall pattern of artefacts
distribution in the graves is non-random and further identify artefacts that deviate
from the random pattern.
The value of $S$ statistic is deemed significantly large at the 0.05 alpha level with
$S \approx 14$ and $p \approx xy$ (Fig. \@ref(fig:f-sstat)).
This suggests that there is enough evidence that the overall distribution of
artefacts in the graves is not random.


<!-- ```{r t-vstat} -->
<!-- vstat <- read_csv(here("data/temp", "v_statistics.csv")) %>% -->
<!--     select(full, v, p) %>% -->
<!--     mutate(v = round(v, 2), p = round(p, 2)) %>% -->
<!--     rename("variable" = full, "v statistic" = v, "p value" = p) -->

<!-- knitr::kable( -->
<!--   vstat, -->
<!--   caption = 'Fuuuuu' -->
<!-- ) -->
<!-- ``` -->

<!-- ======================================================================= -->

# Discussion





<!-- ======================================================================= -->
<!-- FIGURES --><!-- FIGURES --><!-- FIGURES --><!-- FIGURES --><!-- FIGURES -->
```{r plan-graphs, fig.cap = "Neighborhood graphs: Delaunay triangulation and Gabriel graph"}
knitr::include_graphics(here("plots/plan_gabriel.pdf"))
```

```{r label-spat-funs}
label_spat_funs <- paste("Functions *G*, *F*, *K* and *T*.",
"*Dashed line* -- theoretical curve under complete spatial randomness, *solid line* -- empirical curve, *gray area* -- envelope.")
```
```{r spat-funs, fig.cap=label_spat_funs}
knitr::include_graphics(here("plots/pointprocess_fun.pdf"))
```

```{r label-nb-sex}
label_nb_sex <- paste("Mean neighbors in a given sex category.",
"*Gray area* -- density estimation for the simulated data, *vertical line* -- observed value.",
"*F* -- female-sexed body, *M* -- male-sexed body, *n. a.* -- non adult, *ind.* -- indetermined sex.")
```
```{r nb-sex, fig.cap=label_nb_sex}
knitr::include_graphics(here("plots/nb_sex.pdf"))
```


```{r f-sstat, fig.cap = "Distribution of simulated and observed S statistic"}
knitr::include_graphics(here("plots/s_statistic.pdf"))
```

```{r f-vstat, fig.cap = "Simulated and observed v statistics for different variables"}
knitr::include_graphics(here("plots", "v_values.pdf"))
```

```{r f-cooc, fig.cap = "Networks of variables frequently present together and exluding each other"}
knitr::include_graphics(here("plots", "cooc_networks.pdf"))
```


<!-- ======================================================================= -->
<!-- TABLES --><!-- TABLES --><!-- TABLES --><!-- TABLES --><!-- TABLES -->
```{r nb-tab-sex}
tab <- read_csv(here("data/temp/nb_sex_p.csv")) %>%
         mutate(relation = str_c(from, to, sep = " - ")) %>%
  select(relation, everything(), -from, -to)

tnames <- c("relation", rep(c("mean", "p"), 3))

knitr::kable(tab, booktabs = TRUE, col.names = tnames, linesep = "", caption = "Results...") %>%
  kableExtra::add_header_above(c(" ", "Buffer" = 2, "Delaunay" = 2, "Gabriel" = 2))
```


<!-- ======================================================================= -->

# References
